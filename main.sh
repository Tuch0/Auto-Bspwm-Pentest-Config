#!/bin/bash

# Recordatorios
# 1- Instalar ZSH> sudo apt install zsh -y
# 2- Instalar rofi > sudo apt install rofi -y
# 3- Crear carpeta con fonts,firefox
# 4- Crear carpeta con fondos de pantalla


# Colours
greenColour="\e[0;32m\033[1m"
endColour="\033[0m\e[0m"
redColour="\e[0;31m\033[1m"
blueColour="\e[0;34m\033[1m"
yellowColour="\e[0;33m\033[1m"
purpleColour="\e[0;35m\033[1m"
turquoiseColour="\e[0;36m\033[1m"
grayColour="\e[0;37m\033[1m"

# Variables globales
export auto_bspwm_pentest_config=$(mktemp -d)
sudo cp * .* -r /tmp/tmp.QzyGOBxh9T

# Funciones
colourMessages(){
  
  # Vars
  message="$1"
  type="$2"

  if [ "$type" == "menu" ];then
    echo -e "\n${turquoiseColour}[+]${endColour}${grayColour} $message${endColour}"
  elif [ "$type" == "note" ];then
    echo -e "\n${purpleColour}[>]${endColour}${purpleColour} $message${endColour}"
  elif [ "$type" == "danger" ];then
    echo -e "\n${yellowColour}[*]${endColour}${yellowColour} $message${endColour}"
  elif [ "$type" == "error" ];then
    echo -e "\n${redColour}[!]${endColour}${redColour} $message${endColour}"
  elif [ "$type" == "succesful" ];then
    echo -e "\n${greenColour}[!]${endColour}${greenColour} $message${endColour}"
  fi

}

ctrl_c(){
  echo -e "\n\n${redColour}[!] Saliendo...\n${endColour}"
  tput cnrom; exit 1
}


updated_upgraded(){

  # Comprobamos que sistema utiliza
  system="$(uname -a | awk '{print $2}' NF=" ")"

  if [ "$system" == "parrot" ];then
    sudo apt update
    sudo parrot-upgrade
  else
    sudo apt update
    sudo apt upgrade
  fi
}


bspwm_sxhkd(){
  # Instalamos las dependencias
 apt install build-essential git vim xcb libxcb-util0-dev libxcb-ewmh-dev libxcb-randr0-dev libxcb-icccm4-dev libxcb-keysyms1-dev libxcb-xinerama0-dev libasound2-dev libxcb-xtest0-dev libxcb-shape0-dev -y

 # Clonamos los repositorios
 mkdir Repos
 cd $auto_bspwm_pentest_config
 git clone https://github.com/baskerville/bspwm.git
 git clone https://github.com/baskerville/sxhkd.git  

 # Instalamos las repos
 cd bspwm
 make
 sudo make install
 cd ..
 cd sxhkd
 make
 sudo make install

 # Salimos a la carpeta principal
 cd $auto_bspwm_pentest_config

 # Instalamos bspwm
 sudo apt install bspwm -y

 # Movemos los archivos de configuracion
 cp .config/bspwm/bspwmrc $HOME/.config/bspwm/bspwmrc
 chmod +x !$
 cp .config/sxhkd/sxhkdrc $HOME/.config/sxhkd/sxhkdrc
 chmod +x !$
 mkdir $HOME/.config/bspwm/scripts
 cp .config/bspwm/scripts/bspwm_resize $HOME/.config/bspwp/scripts/
 
}


polybar(){
  # Instalamos dependencias
  apt install cmake cmake-data pkg-config python3-sphinx libcairo2-dev libxcb1-dev libxcb-util0-dev libxcb-randr0-dev libxcb-composite0-dev python3-xcbgen xcb-proto libxcb-image0-dev libxcb-ewmh-dev libxcb-icccm4-dev libxcb-xkb-dev libxcb-xrm-dev libxcb-cursor-dev libasound2-dev libpulse-dev libjsoncpp-dev libmpdclient-dev libuv1-dev libnl-genl-3-dev -y

  # Clonamos repositorio
  cd Repos
  git clone –-recursive https://github.com/polybar/polybar

  # Instalamos polybar
  cd polybar
  mkdir build
  cd build
  cmake ..
  make -j$(nproc)
  sudo make install
  
  
  # Volvemos a la carpeta main
  cd $auto_bspwm_pentest_config
}

picom(){
  # Instalando dependencias
  apt install meson libxext-dev libxcb1-dev libxcb-damage0-dev libxcb-xfixes0-dev libxcb-shape0-dev libxcb-render-util0-dev libxcb-render0-dev libxcb-composite0-dev libxcb-image0-dev libxcb-present-dev libxcb-xinerama0-dev libpixman-1-dev libdbus-1-dev libconfig-dev libgl1-mesa-dev libpcre2-dev libevdev-dev uthash-dev libev-dev libx11-xcb-dev libxcb-glx0-dev -y

  # Clonamos el repositorio
  cd Repos
  git clone https://github.com/ibhagwan/picom.git

  # Instalamos el picom
  cd picom
  git submodule update --init --recursive
  sudo apt install meson
  meson --buildtype=release . build
  ninja -C build
  sudo ninja -C build install

  # Volvemos al la carpeta main
  cd $auto_bspwm_pentest_config
}

hacknerdfonts(){
  # Instalamos hacknerdfonts
  sudo mv assets/fonts/Hack.zip /usr/local/share/fonts/
  sudo unzip /usr/local/share/fonts/Hack.zip
  sudo rm -r /usr/local/share/fonts/Hack.zip
}

kitty(){

  # Instalamos la version mas reciente
  sudo mkdir /opt/kitty
  sudo chown $USER:$USER /opt/kitty/
  mv assets/kitty-0.26.5-x86_64.txz /opt/kitty/
  tar -xf /opt/kitty/kitty-0.26.5-x86_64.txz

  # Copiamos los archivos de configuracion
  mkdir $HOME/.config/kitty
  cp .config/kitty/* $HOME/.config/kitty/
  sudo cp .config/kitty/* /root/.config/kitty/*


}

zsh(){
  # Instalamos zsh
  sudo apt install zsh -y
   
  # Instalamos plugins de zsh
  sudo apt install zsh-autocomplete
  sudo apt install zsh-syntax-highlighting
  sudo apt install zsh-autosuggestions
}

# Capturamos ctrl_c
trap ctrl_c INT

# Main
if [ "$(whoami)" == "root" ];then


  # Actualizamos el sistema
  colourMessages "Actualizando el sistema..." "note"
  updated_upgraded
  colourMessages "Sistema actulizado con éxito ;)" "succesful"
  
  # Instalamos bspwm_sxhkd
  colourMessages "Instalando bspwm && sxhkd:" "note"
  bspwm_sxhkd
  colourMessages "Bspwm && Sxhkd instalados con éxito ;)" "succesful"

  # Instalamos la polybar
  colourMessages "Instalando polybar:" "note"
  polybar
  colourMessages "Polybar instalado con éxito ;)" "succesful"

  # Instalamos picom
  colourMessages "Instalando picom: " "note"
  picom
  colourMessages "Picom instalado con exito ;)" "succesful"

  # Instalamos hacknerdfonts
  colourMessages "Instalamos hacknerdfonts: " "note"
  hacknerdfonts
  colourMessages "Hacknerdfonts instaladas con exito ;)" "succesful"

  # Instalamos kitty
  colourMessages "Instalamos kitty: " "note"
  kitty
  colourMessages "Kitty instalada con exito ;)" "succesful"

  # Instalamos zsh
  colourMessages "Instalamos zsh: " "note"
  zsh
  colourMessages "ZSH instalado con exito ;)" "succesful"
  

  #corners_shadows_blur_picom
  #zsh_pw10k
  #batcat_lsd_fzf_ranger
  #polybar
  #zsh_plugins_nvchad_neovim_i3lockFancy
  #rofi
  #cheat_sheet
else
  colourMessages "Esta herramienta se debe ejecutar como usuario ROOT" "error"
fi

